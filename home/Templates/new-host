{ 
  config,
  lib,
  pkgs,
  self,
  ...
} @ inputs: {
    
  boot = {
    loader.systemd-boot.enable = true;
    initrd = {
      kernelModules = [ "kvm-intel" "virtio_balloon" "virtio_console" "virtio_rng" ];
      availableKernelModules = [ "9p" "9pnet_virtio" "ata_piix" "nvme" "sr_mod" "uhci_hcd" "virtio_blk" "virtio_mmio" "virtio_net" "virtio_pci" "virtio_scsi" "xhci_pci" ];
      systemd.enable = true;
    };
    kernelPackages = pkgs.linuxPackages_6_1; 
    extraModulePackages = [ self.config.boot.kernelPackages.broadcom_sta ];
  };
  
  this = {
    user = {
      enable = true;
      me.name = "pungkula";  # Replace with a variable if needed
    };
    host = {
      system = "x86_64-linux";
      hostname = "${HOSTNAME}";  # Variable placeholder
      autoPull = false;
      interface = [ "" ];
      ip = "";
      wgip = "10.0.0.1";
      modules = {
        hardware = [ "cpu/intel" "audio" ];
        system = [ "nix" "pkgs" ];
        networking = [ "default" "pool" ];
        services = [ "ssh" "backup" ];
        programs = [ ];
        virtualisation = [ "" ];
      };  
      keys.publicKeys = {
        host = "";
        ssh = "";
        age = "";
        wireguard = "BlpQEu1MJbNmx32zgTFO0Otnkb+4XA1pwVdhjHtJBiQ=";
        builder = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINQ7c/AeIpmJS6cWQkHOe4ZEq3DXVRnjtTWuWfx6L46n";
        cache = "cache:/pbj1Agw2OoSSDZcClS69RHa1aNcwwTOX3GIEGKYwPc=";
        adb = "QAAAACEJNfsfRV4PQ9Ah87MbTVbMkbXC6CAMDOR+0K6mIpv/4TSzYMkc2qit3Kryc55IVOjwR3fJRjj/uL549gZ7nEemWtcd3AsYQBp0iIEor8nu1L/V6jfsTY6Xe/pl06xoroy6OwZRWuDbZ4wD2xQRRQjfPd+JtYnMAWneM6r1V15uR67w4ITvjk3ckyfgNeLZMUwahMRjC3wSjaU9sAdKNmg8yPd8uHZ+mK6mstxJFAGEpnnm1lE7Z2r0DF6h6MKY1++dwhU+WM5BRDNiBg+D4i6fDW4+Z1I9ENuFnjT17zAxZXch04SNlG3O94BANYP7jmKp60OvtDL6msfphntuIUzMCkndF9De0Kv4lJdQxe1d+wf+AFpmtd/xtrk45YdMV+eWCJf2OkidaHmSj4ffkAobpun0VrkZN2Z1JymmdsvUbyMjAsby3Zun0xr3EocUS8Jy5TcsK/dcpD6CB5dqzlHhsHSAWt2TDwPzZYXgV1xc+q+PqM09OVN1xActJu75UMkg5b84U15hwQvYdwB8UaopMWWk6p064c7gxYSfH7fSxwkW2Jy1CElgJa55Pp4SZG9b/3B+VcNL1WSf6v/lvJqPbrRvBqvS0+e9wcFMNZtQKTX3n5X0wW1/czZPCQX+hmM8Uu1qrtaz4rKViIEGf4YR0/9eUGYQVfuAxAh8ZmsroJlnAAEAAQA= pungkula@desktop";
      };
    };    
  };                

  fileSystems."/boot" = { device = "/dev/disk/by-label/boot"; fsType = "vfat"; };
  fileSystems."/" = { device = "/dev/disk/by-label/nixos"; fsType = "ext4"; };
  swapDevices = [{ device = "/dev/disk/by-label/swap"; }];

  hardware.enableAllFirmware = true;
  system.stateVersion = "24.05";
}
